# 机器学习笔记

## 一、introduce

- 这本电子书建立在使用MATLAB进行机器学习的基础上，该书回顾了机器学习的基础知识，并介绍了有监督和无监督的技术。
- 以心音分类器(heart sounds classifier)为例，类似完成用于开发实际机器学习应用程序的完整工作流程，从加载数据到部署经过训练的模型。 对于每个训练阶段，都会演示对获得精确模型至关重要的技术，以掌握更具挑战性的训练任务，包括选择算法，优化模型参数和避免过度拟合。
- 在这本电子书中，将学习如何通过在新数据上训练模型，提取功能以及生成用于部署在嵌入式设备上的代码来将模型转变为预测工具

> 训练：迭代直到达到你满意的表现
>> 读取和预处理数据->提取特征->训练模型->优化性能参数->模型

> 预测：将训练模型整合到应用程序中
>> 捕获传感器数据->提取特征->运行模型->预测

---

## 二、Building a Heart Sounds Classification Application with MATLAB

*心脏的声音(Heart sounds)是早期诊断心脏病的丰富信息来源。 区分正常与异常心音需要经过专门培训的临床医生。目标是开发一种可以识别异常心音的机器学习应用程序。使用心音监测应用程序，常规医务人员可以在没有专科医生的情况下筛查心脏病，患者可以自我监测。*
*在开发此应用程序时，将按照以下步骤操作：*

1. *访问和浏览数据。*
2. *预处理数据并提取特征。*
3. *建立预测模型。*
4. *优化模型。*
5. *将分析部署到生产系统。*

### step1 访问和浏览数据

- 示例数据：2016年PhysioNet和心脏病学计算挑战赛中的数据集，该数据集包含数千种记录的心音，长度从5秒到120秒不等。
- 数据集包括用于模型训练的3240条记录和用于模型验证的301条记录。（训练和验证集存储在单独的文件夹中）

#### Exploring the Data

- 任何机器学习项目的第一步都是了解自己正在使用哪种数据。 探索数据的常用方法包括检查一些示例，创建可视化效果以及（更高级的）应用信号处理或聚类技术来识别模式。
- 为了了解如何区分正常和异常心音所涉及的内容，让我们先听一些示例。
    > 会注意到，异常心音的频率更高，在两次跳动之间会有噪音。 正常的心音更规律，拍子之间保持沉默。

#### Analyzing the Signals

- 通过使用Signal Processing Toolbox™中的Signal Analyzer应用程序在频域中并排查看信号，我们可以更深入地了解这些信号之间的差异，而无需编写任何代码。
- 在对数据和分类任务进行了初步探索之后，我们将所有数据加载到内存中进行预处理。 MATLAB使加载分布在多个目录中的大型数据集变得容易：在完整的数据集上创建一个句柄，然后可以将其以一个或多个块的形式读入内存。 对于大型数据集，MATLAB可以在多个计算资源之间分布执行。
- 每个录音都是标记为异常或正常的音频文件。 因为我们知道数据集中每个文件的真实类别（“ground truth”），所以我们可以应用supervised machine learning，它采用已知的输入数据集和对数据（输出）的已知响应，并训练模型以生成合理的模型去对新数据响应进行预测。

### steps2 预处理数据和提取特征

*大多数数据集在特征提取之前都需要进行一些预处理,典型的任务包括消除异常值和趋势，估算缺失的数据和规范化数据。
本次使用的数据已进行了预处理。
提取和选择功能可以通过关注最有可能产生准确结果的数据来帮助改善机器学习算法。*

#### Extracting Features

- 特征提取是机器学习最重要的部分之一，因为它将原始数据转换为适合机器学习算法的信息。 特征提取消除了许多类型的测量数据中存在的冗余，从而促进了学习阶段的概括。 泛化对于避免将模型过度拟合到特定示例至关重要。

#### Selecting Features

- 虽然特征提取是第一步，但我们需要避免使用太多特征。 具有大量特征的模型在训练阶段需要更多的计算资源，并且使用太多特征会导致过拟合。
- 面临的挑战是找到能够捕获数据中基本模式的最少数量的特征。
- 特征选择是选择与您的特定建模问题最相关的那些特征，并删除不需要或多余的特征的过程。 特征选择的常用方法包括逐步回归，顺序特征选择和正则化。
- 如果有大量数据集和许多特征，则特征提取可能很耗时。 为了加快此过程，可以使用Parallel Computing Toolbox™中的parfor循环结构，并在可用内核之间分配计算（或扩展到集群）。

> 在心音示例中，基于我们对信号分类的了解，
> 我们可以提取以下类型的特征：
    - 摘要统计：平均值，中位数和标准差
    - 频域：主导频率，频谱熵和梅尔频率倒谱系数（MFCC）

提取上面列出的这些类型的特征会从音频信号中得到26个特征。

### step3 Develop Predictive Models

*开发预测模型是一个涉及以下步骤的迭代过程：*

1. *选择训练和验证数据*
1. *选择分类算法。*
1. *反复训练和评估分类模型*

#### Selecting the Training and Validation Data

- 在训练实际的分类器之前，我们需要将数据分为训练和验证集。验证集用于在模型开发过程中测量准确性。**对于诸如心音数据的大型数据集，保留一定百分比的数据是合适的； 对于较小的数据集，建议使用交叉验证**，因为它可以最大化用于模型训练的数据量，并且通常可以使模型更好地推广。
- 当选择“不验证”时，将在整个数据集中对模型进行训练和评估-不保留任何数据以进行验证。在整个数据集上对模型进行重新训练会严重影响其性能，尤其是在数据集非常有限的情况下。在了解模型在训练集上执行的准确性如何，可以指导我们采取哪种方法来进一步改进模型。

#### Selecting a Classification Algorithm

- 没有任何一种机器学习算法可以解决所有问题，而确定正确的算法通常是反复试验的过程。但是，了解各种算法的关键特性后，我们可以选择首先尝试哪种算法，并了解正在做出的取舍。

> 对于心音示例，我们使用 Classification Learner app 去快速比较分类。

#### Iteratively Training and Evaluating Classification Models

- 现在我们准备开始模型的迭代训练和评估。我们可以按照蛮力方法并运行所有算法（使用分类学习器应用程序很容易做到），也可以从看起来最合适的算法开始具体的分类任务。
- 可以同时选择一个或多个分类器，例如“所有支持向量机”。然后，可以并行训练分类器，并比较它们在数据上的性能。对于训练的每个分类器，将根据保留的验证数据或使用交叉验证来估计准确性，这取决于您在上一步中选择用于验证的数据。
- 对于我们的心音应用而言，初步结果表明，（“Find”）K最近邻（KNN）分类器表现良好，其次是二次支持向量机（SVM）和（Find）决策树。
- 例子中，最初的心音分类器达到了90％以上的准确率。但对于心脏筛查应用来说仍然不够。我们如何进一步改善模型的性能?

### step4 Optimize the Model

为了提高模型性能，除了尝试其他（更复杂的）算法外，我们还需要对流程进行更改。通用方法侧重于机器学习模型开发的以下方面之一：

- 调整模型参数。通过更改关键模型参数的默认设置，我们几乎总是可以提高性能。
- 添加或修改训练数据。添加训练数据将有助于我们达到过度拟合的程度（错误率开始增加时）。额外的预处理可以纠正我们可能忽略的数据本身的任何问题，例如数据损坏，离群值或缺失值。
- 转换或提取特征。如果我们当前的功能集无法捕获数据中固有的所有变化，则提取其他功能可能会有所帮助。相反，如果我们看到过度拟合的迹象，则可以尝试通过应用诸如主成分分析（PCA），线性判别分析（LDA）或奇异值分解（SVD）等归约技术来进一步简化特征集。如果特征的比例尺差异很大，则特征转换（例如规范化）可能会有所帮助。
- 进行特定于任务的权衡。如果某些错误分类不如其他错误分类理想，则可以应用成本矩阵为特定的预测类别分配不同的权重（例如，将实际心脏状况错误分类为正常）。
由于我们的模型在测试数据上的准确性几乎达到了与训练数据相同的精度，因此添加更多的训练数据不太可能改善它。 为了进一步提高心音分类器的准确性，我们将首先尝试更复杂的算法，然后引入偏差并调整模型参数。

#### Trying a More Complex Classifier

- 使用单独的分类树往往会过度拟合训练数据。 为了克服这种趋势，我们将尝试使用分类树的合奏（commonly known as “random forests”）。 借助心音数据，袋装决策树集合可达到93％的准确性-在这种情况下，最佳分类器没有任何改进。

#### Introducing Bias

- 到目前为止，我们已经假设所有分类错误都是同样不可取的，但是并非总是如此。例如，在心音应用中，假阴性（未能检测到实际的心脏状况）比假阳性（错误地将正常心音分类为异常）产生的后果要严重得多。
- 为了探索不同种类的错误分类之间的权衡，我们将使用混淆矩阵。 （我们可以通过从分类学习器应用程序中的散点图视图切换来轻松获得混淆矩阵。）心音分类器的混淆矩阵显示，我们的初步模型仅将5％的正常声音误分类为异常，而将12％的异常分类为听起来正常。换句话说，虽然我们错误地标记了5％的健康心脏，但我们无法检测到超过10％的实际心脏状况，这种情况在医学实践中显然是无法接受的。
- 此示例说明了仅基于整体精度（此模型几乎为94％）来分析性能会产生误导。当数据不平衡时就会发生这种情况，在这种情况下，我们的数据集包含的正常声音大约是异常心音的四倍。
- 为了提高特定任务的性能，我们将偏向分类器以最大程度地减少实际心脏状况的错误分类。可以接受的折衷是，该模型会将更多正常的心音误分类为异常。
- 偏向分类器的标准方法是引入成本函数，该函数将较高的罚款分配给不希望的错误分类。
- 以下代码引入了一个cost函数，该函数将异常声音的错误分类罚款20倍。
- 混淆矩阵显示，生成的模型无法检测到少于8％的异常声音，而将更多的正常声音误分类为异常（8％，相比之下，无偏模型为5％）。该模型的总体准确性仍然很高，为92 ％。

#### Tuning Model Parameters

- 可以使用接收器工作特性（ROC）曲线代替使用散布图和混淆矩阵来探索真假阳性之间的权衡。 ROC曲线是一种有用的工具，可以直观地查看正阳性和假阳性之间的折衷。您可以使用ROC曲线为分类器选择最佳工作点或截止值，以最大程度地降低成本函数定义的总体“成本”。
- 如我们所见，可以调整机器学习算法的参数以达到更好的拟合度。 识别提供最佳模型的参数集的过程通常称为“超参数调整”。 为了使超参数调整更有效并提高找到最佳参数值的几率，我们可以在MATLAB中使用自动网格搜索和贝叶斯优化。
- 网格搜索(**Grid search**)会穷举搜索一组有限的参数值组合，但可能会花费很长时间。
- 贝叶斯优化(**Bayesian optimization**)开发了超参数空间的统计模型，旨在最大程度地减少找到最佳值所需的实验次数。
- 示例脚本使用贝叶斯优化执行超参数调整，同时引入了成本函数。

#### Using Feature Selection to Correct Misclassification and Overfitting

- 到目前为止，我们已经使用了训练模型时提取的全部26个功能。优化性能的最后一种方法需要选择特征：删除多余的特征或不携带有用信息的特征。此步骤减少了计算成本和存储要求，并且导致了较简单的模型，不太可能过拟合。
- 减少功能集对于心音应用程序很重要，因为它减小了模型的大小，从而更易于在嵌入式设备上进行部署。
- 特征选择方法包括系统地评估特征子集（在计算上非常昂贵），以及通过对每个特征施加权重将特征选择合并到模型构建过程中（使用更少的特征有助于最小化训练过程中使用的目标函数）。
- 对于我们的心音分类器，我们应用邻域分量分析（NCA），这是一种功能强大的特征选择技术，可以处理超高维数据集。 NCA显示，大约一半的功能对模型没有显着贡献。因此，我们可以将特征数量从26个减少到15个。
- 为了评估仅选择15个功能对性能的影响，我们通过超参数调整和激活的成本函数对模型进行了重新训练。更新后的模型仅能检测到6％的异常心脏状况，比以前略有改善，但错误地将15％的心脏状况分类 正常情况为异常，会稍微降低整体精度。 在医学实践中，将对任何阳性结果进行额外的检查，从最初的筛查中消除大部分15％的假阳性。

#### Iterating to Try Other Algorithms

- 为了进一步改善模型，我们可以尝试使用不同算法的相同系列优化步骤，因为各种优化技术所产生的改进效果会因算法而异。 您可以重复上一节中描述的迭代过程，例如，重新访问最初表现良好的KNN算法。您甚至可以返回特征提取阶段并寻找其他特征。 为了确定最佳模型，总是有必要在机器学习工作流程的不同阶段之间进行迭代。您已经掌握了机器学习，可以从评估当前模型中推断出下一步该怎么做。
- 在我们令人心动的示例中，我们准备继续下一步，即最后一步：部署分类器。

### step5 Deploy Analytics to a Production System

*机器学习应用程序可以部署到台式机，企业IT系统（现场或云中）和嵌入式系统中的生产系统中。 对于台式机和企业IT系统，您可以通过将代码编译为独立应用程序或与以另一种语言编写的应用程序（例如C / C ++，Python®，Java®或.NET）集成来在服务器上部署MATLAB应用程序。 许多嵌入式应用程序需要使用C代码进行模型部署。
通过自动将MATLAB转换为C代码，MATLAB Coder™使得在嵌入式系统上的部署变得容易。*

#### Generating C Code

我们的心音诊断应用程序将在可穿戴式心脏监护仪或移动应用程序等医疗设备上运行。 为了准备部署应用程序，我们通过执行以下步骤从模型生成C代码：

1. 将训练后的模型另存为紧凑模型。
2. 启动MATLAB Coder。
3. 创建一个将原始传感器数据作为输入的入口点功能

并将患者的心音分类为正常还是异常。MATLAB Coder自动生成相应的C代码。

- 为了验证生成的C或C++代码，我们实现了一个简单的原型应用程序，该应用程序对验证数据集中的文件进行交互式分类。此处描述的三步过程生成了一个可执行版本，可以从MATLAB内调用它。我们将在我们的原型中使用该版本（该原型是用MATLAB而非C语言编写的）。

## 3、Essential Tools for Machine Learning

借助MATLAB和专用工具箱，无需广泛的机器学习或数据科学知识即可开发，调整和部署预测分析。 MATLAB和相关产品提供了构建和部署分析所需的所有工具：

- 数据处理功能可简化耗时的任务，包括处理丢失的数据或异常值，消除噪声以及以不同的采样率对数据进行时间对齐
- 专业的机器学习应用程序可加快您的工作流程，让您快速比较和选择算法
- 用于删除不必要功能和微调模型参数以实现强大性能的程序化工作流
- 用于将机器学习工作流程扩展到大数据和计算集群的工具
- 自动代码生成工具，可将您的分析快速部署到嵌入式目标

预构建的功能和算法支持专门的应用程序，例如深度学习，计算机视觉，财务，图像处理，文本分析和自治代理。

> Access and Explore Data
>
>- Database Toolbox™
>- Datafeed Toolbox™
>- OPC Toolbox™
>- Signal Processing Toolbox™
>- Vehicle Network Toolbox™

> Preprocess Data and Extract Features
>
>- Computer Vision System Toolbox™
>- Fuzzy Logic Toolbox™
>- Image Processing Toolbox™
>- Optimization Toolbox™
>- Signal Processing Toolbox™
>- Statistics and Machine Learning Toolbox™
>- System Identification Toolbox™
>- Text Analytics Toolbox™
>- Wavelet Toolbox™

> Develop and Optimize Predictive Models
>
>- Classification Learner App
>- Deep Learning Toolbox™
>- Parallel Computing Toolbox™
>- Regression Learner App
>- Statistics and Machine Learning Toolbox™

> Deploy Analytics to a Production System
>
>- HDL Coder™
>- MATLAB Coder™
>- MATLAB Compiler™
>- MATLAB Compiler SDK™
>- MATLAB Production Server™
